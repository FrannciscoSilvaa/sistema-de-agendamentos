<!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Sistema de Atendimento Psicol√≥gico - Secretaria Municipal de Educa√ß√£o">
  <title>Sistema de Atendimento Psicol√≥gico</title>
  <script src="/_sdk/data_sdk.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100%;
      padding: 20px;
    }

    html {
      height: 100%;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }

    .header {
      background: white;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 20px;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .header h1 {
      color: #2d3748;
      font-size: 28px;
      margin-bottom: 10px;
    }

    .header p {
      color: #718096;
      font-size: 16px;
    }

    .login-screen {
      background: white;
      border-radius: 12px;
      padding: 40px;
      max-width: 500px;
      margin: 0 auto;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .login-screen h2 {
      text-align: center;
      color: #2d3748;
      margin-bottom: 30px;
    }

    .access-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }

    .access-card {
      border: 3px solid #e2e8f0;
      border-radius: 12px;
      padding: 30px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      background: #f7fafc;
    }

    .access-card:hover {
      border-color: #667eea;
      transform: translateY(-5px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .access-card.selected {
      border-color: #667eea;
      background: #edf2f7;
    }

    .access-card .icon {
      font-size: 48px;
      margin-bottom: 10px;
    }

    .access-card .title {
      font-size: 18px;
      font-weight: 600;
      color: #2d3748;
    }

    .login-form {
      display: none;
    }

    .login-form.active {
      display: block;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      color: #2d3748;
      font-weight: 600;
      font-size: 14px;
    }

    .form-input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.2s;
    }

    .form-input:focus {
      outline: none;
      border-color: #667eea;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
    }

    .btn-primary {
      background: #667eea;
      color: white;
      width: 100%;
    }

    .btn-primary:hover:not(:disabled) {
      background: #5568d3;
    }

    .btn-secondary {
      background: #718096;
      color: white;
    }

    .btn-secondary:hover {
      background: #4a5568;
    }

    .btn-success {
      background: #48bb78;
      color: white;
    }

    .btn-success:hover:not(:disabled) {
      background: #38a169;
    }

    .btn-danger {
      background: #f56565;
      color: white;
    }

    .btn-danger:hover {
      background: #e53e3e;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .main-panel {
      display: none;
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .main-panel.active {
      display: block;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #e2e8f0;
    }

    .panel-header h2 {
      color: #2d3748;
      font-size: 24px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 25px;
      border-radius: 12px;
      text-align: center;
    }

    .stat-number {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }

    .appointments-list {
      margin-top: 30px;
    }

    .appointment-card {
      background: #f7fafc;
      border-left: 4px solid #cbd5e0;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 15px;
      transition: all 0.2s;
    }

    .appointment-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .appointment-card.scheduled {
      border-left-color: #4299e1;
      background: #ebf8ff;
    }

    .appointment-card.completed {
      border-left-color: #48bb78;
      background: #f0fff4;
    }

    .appointment-card.cancelled {
      border-left-color: #f56565;
      background: #fff5f5;
    }

    .appointment-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 15px;
    }

    .patient-info h3 {
      color: #2d3748;
      font-size: 18px;
      margin-bottom: 5px;
    }

    .appointment-datetime {
      color: #4a5568;
      font-size: 14px;
      font-weight: 600;
    }

    .status-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .status-scheduled {
      background: #bee3f8;
      color: #2c5282;
    }

    .status-completed {
      background: #c6f6d5;
      color: #22543d;
    }

    .status-cancelled {
      background: #fed7d7;
      color: #742a2a;
    }

    .appointment-details {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 15px;
      font-size: 14px;
      color: #4a5568;
    }

    .detail-item strong {
      color: #2d3748;
    }

    .appointment-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .session-count-badge {
      background: #667eea;
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      display: inline-block;
      margin-bottom: 10px;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 30px;
      max-width: 600px;
      width: 100%;
      max-height: 90%;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #e2e8f0;
    }

    .modal-header h3 {
      color: #2d3748;
      font-size: 20px;
    }

    .close-modal {
      background: none;
      border: none;
      font-size: 28px;
      color: #718096;
      cursor: pointer;
      line-height: 1;
      padding: 0;
      width: 30px;
      height: 30px;
    }

    .close-modal:hover {
      color: #2d3748;
    }

    textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      resize: vertical;
      min-height: 150px;
    }

    textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    .filter-bar {
      background: #f7fafc;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .filter-group {
      flex: 1;
      min-width: 200px;
    }

    select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      background: white;
      cursor: pointer;
    }

    select:focus {
      outline: none;
      border-color: #667eea;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #718096;
    }

    .empty-state .icon {
      font-size: 64px;
      margin-bottom: 15px;
    }

    .error-message {
      background: #fed7d7;
      color: #742a2a;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 15px;
      text-align: center;
      font-weight: 600;
      display: none;
    }

    .error-message.active {
      display: block;
    }

    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #48bb78;
      color: white;
      padding: 16px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      z-index: 2000;
      font-weight: 600;
      animation: slideIn 0.3s ease;
    }

    .toast.error {
      background: #f56565;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .password-toggle {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      padding: 6px 8px;
      color: #718096;
      transition: all 0.2s;
    }

    .password-toggle:hover {
      background: #f7fafc;
    }

    .loading-spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    footer {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px;
      padding: 25px;
      margin-top: 20px;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      color: white;
    }

    footer p {
      margin: 8px 0;
    }

    @media (max-width: 768px) {
      .access-options {
        grid-template-columns: 1fr;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .appointment-details {
        grid-template-columns: 1fr;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .appointment-actions {
        flex-direction: column;
      }

      .appointment-actions .btn {
        width: 100%;
      }

      .panel-header {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
      }

      .panel-header .btn {
        width: 100%;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <header class="header">
    <h1>Sistema de Atendimento Psicol√≥gico</h1>
    <p>Secretaria Municipal de Educa√ß√£o</p>
   </header>
   <div class="login-screen" id="loginScreen">
    <h2>Selecione o Tipo de Acesso</h2>
    <div class="access-options">
     <div class="access-card" data-type="receptionist">
      <div class="icon">
       üìã
      </div>
      <div class="title">
       Recepcionista
      </div>
     </div>
     <div class="access-card" data-type="psychologist">
      <div class="icon">
       üë©üèΩ‚Äç‚öïÔ∏è
      </div>
      <div class="title">
       Psic√≥loga
      </div>
     </div>
    </div>
    <form class="login-form" id="loginForm">
     <div class="form-group"><label class="form-label" for="password">Senha de Acesso</label>
      <div style="position: relative;"><input type="password" id="password" class="form-input" required placeholder="Digite sua senha" autocomplete="current-password"> <button type="button" class="password-toggle" id="togglePassword" aria-label="Mostrar senha"> <span id="eyeIcon">üëÅÔ∏è</span> </button>
      </div>
     </div>
     <div class="error-message" id="loginError" role="alert"></div><button type="submit" class="btn btn-primary" id="loginBtn"> Entrar </button>
    </form>
   </div>
   <main class="main-panel" id="receptionistPanel" role="main">
    <div class="panel-header">
     <h2>üìã Painel da Recepcionista</h2><button class="btn btn-secondary" id="logoutReceptionist">Sair</button>
    </div>
    <div class="stats-grid" id="receptionistStats"></div>
    <h3 style="margin-bottom: 20px; color: #2d3748;">Novo Agendamento</h3>
    <div style="background: #f7fafc; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
     <div class="form-group"><label class="form-label" for="patientSelect">Selecionar Aluno Cadastrado</label> <select id="patientSelect" class="form-input"> <option value="">-- Novo Aluno --</option> </select>
     </div>
    </div>
    <form id="appointmentForm">
     <div class="form-grid">
      <div class="form-group"><label class="form-label" for="patientName">Nome da Crian√ßa *</label> <input type="text" id="patientName" class="form-input" required autocomplete="name">
      </div>
      <div class="form-group"><label class="form-label" for="patientAge">Idade *</label> <input type="text" id="patientAge" class="form-input" required>
      </div>
      <div class="form-group"><label class="form-label" for="school">Escola *</label> <input type="text" id="school" class="form-input" required autocomplete="organization">
      </div>
      <div class="form-group"><label class="form-label" for="guardianName">Nome do Respons√°vel *</label> <input type="text" id="guardianName" class="form-input" required autocomplete="name">
      </div>
      <div class="form-group"><label class="form-label" for="guardianPhone">Telefone do Respons√°vel *</label> <input type="tel" id="guardianPhone" class="form-input" required autocomplete="tel">
      </div>
      <div class="form-group"><label class="form-label" for="appointmentDate">Data de Agendamento *</label> <input type="date" id="appointmentDate" class="form-input" required>
      </div>
      <div class="form-group"><label class="form-label" for="appointmentTime">Hor√°rio do Atendimento *</label> <input type="time" id="appointmentTime" class="form-input" required>
      </div>
     </div><button type="submit" class="btn btn-primary" style="margin-top: 10px;" id="createAppointmentBtn"> ‚úì Agendar Consulta </button>
    </form>
    <div class="appointments-list">
     <h3 style="margin-bottom: 20px; color: #2d3748;">Agendamentos Ativos</h3>
     <div id="receptionistAppointments"></div>
    </div>
   </main>
   <main class="main-panel" id="psychologistPanel" role="main">
    <div class="panel-header">
     <h2>üë©‚Äç‚öïÔ∏è Painel da Psic√≥loga</h2><button class="btn btn-secondary" id="logoutPsychologist">Sair</button>
    </div>
    <div class="stats-grid" id="psychologistStats"></div>
    <div class="filter-bar">
     <div class="filter-group"><label class="form-label" for="statusFilter">Filtrar por Status</label> <select id="statusFilter"> <option value="all">Todos</option> <option value="scheduled">Agendados</option> <option value="completed">Conclu√≠dos</option> <option value="cancelled">Cancelados</option> </select>
     </div>
     <div class="filter-group"><label class="form-label" for="searchInput">Buscar Paciente</label> <input type="text" id="searchInput" class="form-input" placeholder="Digite o nome...">
     </div>
    </div>
    <div class="appointments-list">
     <div id="psychologistAppointments"></div>
    </div>
   </main>
   <div class="modal" id="editModal" role="dialog" aria-labelledby="editModalTitle" aria-modal="true">
    <div class="modal-content">
     <div class="modal-header">
      <h3 id="editModalTitle">Editar Agendamento</h3><button class="close-modal" data-modal="editModal" aria-label="Fechar">√ó</button>
     </div>
     <form id="editForm">
      <div class="form-grid">
       <div class="form-group"><label class="form-label" for="editPatientName">Nome da Crian√ßa *</label> <input type="text" id="editPatientName" class="form-input" required>
       </div>
       <div class="form-group"><label class="form-label" for="editPatientAge">Idade *</label> <input type="text" id="editPatientAge" class="form-input" required>
       </div>
       <div class="form-group"><label class="form-label" for="editSchool">Escola *</label> <input type="text" id="editSchool" class="form-input" required>
       </div>
       <div class="form-group"><label class="form-label" for="editGuardianName">Nome do Respons√°vel *</label> <input type="text" id="editGuardianName" class="form-input" required>
       </div>
       <div class="form-group"><label class="form-label" for="editGuardianPhone">Telefone do Respons√°vel *</label> <input type="tel" id="editGuardianPhone" class="form-input" required>
       </div>
       <div class="form-group"><label class="form-label" for="editAppointmentDate">Data de Agendamento *</label> <input type="date" id="editAppointmentDate" class="form-input" required>
       </div>
       <div class="form-group"><label class="form-label" for="editAppointmentTime">Hor√°rio do Atendimento *</label> <input type="time" id="editAppointmentTime" class="form-input" required>
       </div>
      </div>
      <div style="display: flex; gap: 10px; margin-top: 20px;"><button type="submit" class="btn btn-success" style="flex: 1;" id="updateAppointmentBtn"> Salvar Altera√ß√µes </button> <button type="button" class="btn btn-secondary" data-modal="editModal">Cancelar</button>
      </div>
     </form>
    </div>
   </div>
   <div class="modal" id="sessionModal" role="dialog" aria-labelledby="sessionModalTitle" aria-modal="true">
    <div class="modal-content">
     <div class="modal-header">
      <h3 id="sessionModalTitle">Registrar Atendimento</h3><button class="close-modal" data-modal="sessionModal" aria-label="Fechar">√ó</button>
     </div>
     <div id="sessionPatientInfo" style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 20px;"></div>
     <form id="sessionForm">
      <div class="form-group"><label class="form-label" for="sessionNotes">Observa√ß√µes do Atendimento *</label> <textarea id="sessionNotes" required placeholder="Descreva as observa√ß√µes, evolu√ß√£o, t√©cnicas utilizadas..."></textarea>
      </div>
      <div style="display: flex; gap: 10px;"><button type="submit" class="btn btn-success" style="flex: 1;" id="completeSessionBtn"> Concluir Atendimento </button> <button type="button" class="btn btn-secondary" data-modal="sessionModal">Cancelar</button>
      </div>
     </form>
    </div>
   </div>
   <div class="modal" id="absenceModal" role="dialog" aria-labelledby="absenceModalTitle" aria-modal="true">
    <div class="modal-content">
     <div class="modal-header">
      <h3 id="absenceModalTitle">Registrar Falta do Paciente</h3><button class="close-modal" data-modal="absenceModal" aria-label="Fechar">√ó</button>
     </div>
     <div id="absencePatientInfo" style="background: #fff5f5; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #f56565;"></div>
     <form id="absenceForm">
      <div class="form-group"><label class="form-label" for="absenceReason">Motivo da Falta *</label> <textarea id="absenceReason" required placeholder="Descreva o motivo da falta ou aus√™ncia do paciente..." style="min-height: 120px;"></textarea>
      </div>
      <div style="display: flex; gap: 10px;"><button type="submit" class="btn btn-danger" style="flex: 1;" id="registerAbsenceBtn"> Registrar Falta </button> <button type="button" class="btn btn-secondary" data-modal="absenceModal">Cancelar</button>
      </div>
     </form>
    </div>
   </div>
   <footer>
    <p style="font-size: 15px; font-weight: 600;">¬© 2024 Sistema de Atendimento Psicol√≥gico</p>
    <p style="font-size: 14px;">Secretaria Municipal de Educa√ß√£o de Cocal dos Alves</p>
    <p style="font-size: 13px; font-style: italic;">"Ensinando com amor, transformando com dedica√ß√£o!"</p>
    <p style="font-size: 12px; opacity: 0.9;">üíª Desenvolvido por <strong style="font-style: italic;">@FranciscoSilva</strong></p>
   </footer>
  </div>
  <script>
    (function() {
      'use strict';

      const PASSWORDS = {
        receptionist: 'mirela123',
        psychologist: 'bia321'
      };

      let allRecords = [];
      let currentUser = null;
      let selectedAccessType = null;
      let currentEditAppointment = null;
      let currentSessionAppointment = null;
      let currentAbsenceAppointment = null;

      const dataHandler = {
        onDataChanged: function(data) {
          allRecords = data;
          
          if (currentUser === 'receptionist') {
            updateReceptionistView();
          } else if (currentUser === 'psychologist') {
            updatePsychologistView();
          }
        }
      };

      async function init() {
        if (window.dataSdk) {
          const result = await window.dataSdk.init(dataHandler);
          if (!result.isOk) {
            showToast('Erro ao conectar com o servidor', 'error');
          }
        }
        
        setupEventListeners();
        checkSavedSession();
      }

      function setupEventListeners() {
        const accessCards = document.querySelectorAll('.access-card');
        accessCards.forEach(function(card) {
          card.addEventListener('click', function() {
            selectAccessType(this.getAttribute('data-type'));
          });
        });

        const togglePasswordBtn = document.getElementById('togglePassword');
        if (togglePasswordBtn) {
          togglePasswordBtn.addEventListener('click', togglePasswordVisibility);
        }

        const loginForm = document.getElementById('loginForm');
        if (loginForm) {
          loginForm.addEventListener('submit', handleLogin);
        }

        const appointmentForm = document.getElementById('appointmentForm');
        if (appointmentForm) {
          appointmentForm.addEventListener('submit', createAppointment);
        }

        const editForm = document.getElementById('editForm');
        if (editForm) {
          editForm.addEventListener('submit', updateAppointment);
        }

        const sessionForm = document.getElementById('sessionForm');
        if (sessionForm) {
          sessionForm.addEventListener('submit', completeSession);
        }

        const absenceForm = document.getElementById('absenceForm');
        if (absenceForm) {
          absenceForm.addEventListener('submit', registerAbsence);
        }

        const logoutReceptionist = document.getElementById('logoutReceptionist');
        if (logoutReceptionist) {
          logoutReceptionist.addEventListener('click', logout);
        }

        const logoutPsychologist = document.getElementById('logoutPsychologist');
        if (logoutPsychologist) {
          logoutPsychologist.addEventListener('click', logout);
        }

        const statusFilter = document.getElementById('statusFilter');
        if (statusFilter) {
          statusFilter.addEventListener('change', applyFilters);
        }

        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
          searchInput.addEventListener('input', applyFilters);
        }

        const patientSelect = document.getElementById('patientSelect');
        if (patientSelect) {
          patientSelect.addEventListener('change', fillPatientData);
        }

        const closeModalBtns = document.querySelectorAll('[data-modal]');
        closeModalBtns.forEach(function(btn) {
          btn.addEventListener('click', function() {
            closeModal(this.getAttribute('data-modal'));
          });
        });
      }

      function selectAccessType(type) {
        selectedAccessType = type;
        const allCards = document.querySelectorAll('.access-card');
        allCards.forEach(function(card) {
          card.classList.remove('selected');
        });
        const selectedCard = document.querySelector('[data-type="' + type + '"]');
        if (selectedCard) {
          selectedCard.classList.add('selected');
        }
        const loginForm = document.getElementById('loginForm');
        if (loginForm) {
          loginForm.classList.add('active');
        }
        const passwordInput = document.getElementById('password');
        if (passwordInput) {
          passwordInput.focus();
        }
      }

      function togglePasswordVisibility() {
        const passwordInput = document.getElementById('password');
        const eyeIcon = document.getElementById('eyeIcon');
        
        if (passwordInput && eyeIcon) {
          if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            eyeIcon.textContent = 'üôà';
          } else {
            passwordInput.type = 'password';
            eyeIcon.textContent = 'üëÅÔ∏è';
          }
        }
      }

      function handleLogin(e) {
        e.preventDefault();
        
        const passwordInput = document.getElementById('password');
        const errorDiv = document.getElementById('loginError');
        
        if (!passwordInput || !errorDiv) return;
        
        const password = passwordInput.value;

        if (password === PASSWORDS[selectedAccessType]) {
          currentUser = selectedAccessType;
          try {
            localStorage.setItem('currentUser', selectedAccessType);
          } catch (err) {
            console.error('Erro ao salvar sess√£o:', err);
          }
          const loginScreen = document.getElementById('loginScreen');
          if (loginScreen) {
            loginScreen.style.display = 'none';
          }
          showPanel(selectedAccessType);
          showToast('Login realizado com sucesso!');
        } else {
          errorDiv.textContent = 'Senha incorreta. Tente novamente.';
          errorDiv.classList.add('active');
        }

        passwordInput.value = '';
      }

      function showPanel(userType) {
        if (userType === 'receptionist') {
          const panel = document.getElementById('receptionistPanel');
          if (panel) {
            panel.classList.add('active');
          }
          updateReceptionistView();
        } else {
          const panel = document.getElementById('psychologistPanel');
          if (panel) {
            panel.classList.add('active');
          }
          updatePsychologistView();
        }
      }

      function logout() {
        currentUser = null;
        selectedAccessType = null;
        try {
          localStorage.removeItem('currentUser');
        } catch (err) {
          console.error('Erro ao remover sess√£o:', err);
        }
        
        const receptionistPanel = document.getElementById('receptionistPanel');
        if (receptionistPanel) {
          receptionistPanel.classList.remove('active');
        }
        
        const psychologistPanel = document.getElementById('psychologistPanel');
        if (psychologistPanel) {
          psychologistPanel.classList.remove('active');
        }
        
        const loginScreen = document.getElementById('loginScreen');
        if (loginScreen) {
          loginScreen.style.display = 'block';
        }
        
        const loginForm = document.getElementById('loginForm');
        if (loginForm) {
          loginForm.classList.remove('active');
        }
        
        const allCards = document.querySelectorAll('.access-card');
        allCards.forEach(function(card) {
          card.classList.remove('selected');
        });
      }

      function checkSavedSession() {
        try {
          const savedUser = localStorage.getItem('currentUser');
          if (savedUser) {
            currentUser = savedUser;
            const loginScreen = document.getElementById('loginScreen');
            if (loginScreen) {
              loginScreen.style.display = 'none';
            }
            showPanel(savedUser);
          }
        } catch (err) {
          console.error('Erro ao verificar sess√£o:', err);
        }
      }

      async function createAppointment(e) {
        e.preventDefault();

        if (allRecords.length >= 999) {
          showToast('Limite de 999 agendamentos atingido. Exclua alguns antes de continuar.', 'error');
          return;
        }

        const btn = document.getElementById('createAppointmentBtn');
        if (btn) {
          btn.disabled = true;
          btn.innerHTML = '<span class="loading-spinner"></span> Salvando...';
        }

        const patientNameInput = document.getElementById('patientName');
        const patientAgeInput = document.getElementById('patientAge');
        const schoolInput = document.getElementById('school');
        const guardianNameInput = document.getElementById('guardianName');
        const guardianPhoneInput = document.getElementById('guardianPhone');
        const appointmentDateInput = document.getElementById('appointmentDate');
        const appointmentTimeInput = document.getElementById('appointmentTime');

        if (!patientNameInput || !patientAgeInput || !schoolInput || !guardianNameInput || !guardianPhoneInput || !appointmentDateInput || !appointmentTimeInput) {
          if (btn) {
            btn.disabled = false;
            btn.innerHTML = '‚úì Agendar Consulta';
          }
          return;
        }

        const appointment = {
          id: Date.now().toString(),
          type: 'appointment',
          patientName: patientNameInput.value.trim(),
          patientAge: patientAgeInput.value.trim(),
          school: schoolInput.value.trim(),
          guardianName: guardianNameInput.value.trim(),
          guardianPhone: guardianPhoneInput.value.trim(),
          appointmentDate: appointmentDateInput.value,
          appointmentTime: appointmentTimeInput.value,
          status: 'scheduled',
          sessionNotes: '',
          absenceReason: '',
          createdAt: new Date().toISOString()
        };

        if (window.dataSdk) {
          const result = await window.dataSdk.create(appointment);
          
          if (result.isOk) {
            e.target.reset();
            const patientSelect = document.getElementById('patientSelect');
            if (patientSelect) {
              patientSelect.value = '';
            }
            showToast('‚úÖ Agendamento criado com sucesso!');
          } else {
            showToast('Erro ao criar agendamento. Tente novamente.', 'error');
          }
        }

        if (btn) {
          btn.disabled = false;
          btn.innerHTML = '‚úì Agendar Consulta';
        }
      }

      function updateReceptionistView() {
        updatePatientSelect();
        
        const appointments = allRecords.filter(function(r) {
          return r.type === 'appointment';
        });
        
        const scheduledOnly = appointments.filter(function(a) {
          return a.status === 'scheduled';
        });
        
        const today = new Date().toISOString().split('T')[0];
        const todayCount = scheduledOnly.filter(function(a) {
          return a.appointmentDate === today;
        }).length;

        const uniquePatients = new Set();
        appointments.forEach(function(a) {
          uniquePatients.add(a.patientName);
        });

        const statsContainer = document.getElementById('receptionistStats');
        if (statsContainer) {
          statsContainer.innerHTML = 
            '<div class="stat-card">' +
              '<div class="stat-number">' + scheduledOnly.length + '</div>' +
              '<div class="stat-label">Agendamentos Ativos</div>' +
            '</div>' +
            '<div class="stat-card">' +
              '<div class="stat-number">' + todayCount + '</div>' +
              '<div class="stat-label">Hoje</div>' +
            '</div>' +
            '<div class="stat-card">' +
              '<div class="stat-number">' + uniquePatients.size + '</div>' +
              '<div class="stat-label">Alunos Cadastrados</div>' +
            '</div>';
        }

        const recent = scheduledOnly.slice().sort(function(a, b) {
          return new Date(b.createdAt) - new Date(a.createdAt);
        }).slice(0, 20);

        const appointmentsContainer = document.getElementById('receptionistAppointments');
        if (!appointmentsContainer) return;

        if (recent.length === 0) {
          appointmentsContainer.innerHTML = 
            '<div class="empty-state">' +
              '<div class="icon">üìÖ</div>' +
              '<p>Nenhum agendamento ativo no momento.</p>' +
            '</div>';
        } else {
          appointmentsContainer.innerHTML = recent.map(function(apt) {
            return '<div class="appointment-card ' + apt.status + '">' +
              '<div class="appointment-header">' +
                '<div class="patient-info">' +
                  '<h3>' + escapeHtml(apt.patientName) + '</h3>' +
                  '<div class="appointment-datetime">üìÖ ' + formatDate(apt.appointmentDate) + ' √†s ' + apt.appointmentTime + '</div>' +
                '</div>' +
                '<span class="status-badge status-' + apt.status + '">' + getStatusText(apt.status) + '</span>' +
              '</div>' +
              '<div class="appointment-details">' +
                '<div class="detail-item"><strong>Idade:</strong> ' + escapeHtml(apt.patientAge) + '</div>' +
                '<div class="detail-item"><strong>Escola:</strong> ' + escapeHtml(apt.school) + '</div>' +
                '<div class="detail-item"><strong>Respons√°vel:</strong> ' + escapeHtml(apt.guardianName) + '</div>' +
                '<div class="detail-item"><strong>Telefone:</strong> ' + escapeHtml(apt.guardianPhone) + '</div>' +
              '</div>' +
              '<div class="appointment-actions" style="margin-top: 15px;">' +
                '<button class="btn btn-primary" onclick="window.appFunctions.openEditModal(\'' + apt.__backendId + '\')" style="font-size: 13px; padding: 8px 16px;">' +
                  '‚úèÔ∏è Editar' +
                '</button>' +
              '</div>' +
            '</div>';
          }).join('');
        }
      }

      function updatePsychologistView() {
        const appointments = allRecords.filter(function(r) {
          return r.type === 'appointment';
        });
        
        const scheduled = appointments.filter(function(a) {
          return a.status === 'scheduled';
        }).length;
        
        const completed = appointments.filter(function(a) {
          return a.status === 'completed';
        }).length;
        
        const uniquePatients = new Set(appointments.map(function(a) {
          return a.patientName;
        })).size;

        const statsContainer = document.getElementById('psychologistStats');
        if (statsContainer) {
          statsContainer.innerHTML = 
            '<div class="stat-card">' +
              '<div class="stat-number">' + scheduled + '</div>' +
              '<div class="stat-label">Agendados</div>' +
            '</div>' +
            '<div class="stat-card">' +
              '<div class="stat-number">' + completed + '</div>' +
              '<div class="stat-label">Conclu√≠dos</div>' +
            '</div>' +
            '<div class="stat-card">' +
              '<div class="stat-number">' + uniquePatients + '</div>' +
              '<div class="stat-label">Pacientes √önicos</div>' +
            '</div>';
        }

        applyFilters();
      }

      function applyFilters() {
        const statusFilter = document.getElementById('statusFilter');
        const searchInput = document.getElementById('searchInput');
        
        if (!statusFilter || !searchInput) return;
        
        const statusValue = statusFilter.value;
        const searchTerm = searchInput.value.toLowerCase();

        const appointments = allRecords.filter(function(r) {
          return r.type === 'appointment';
        });

        let filtered = appointments.slice();

        if (statusValue !== 'all') {
          filtered = filtered.filter(function(a) {
            return a.status === statusValue;
          });
        }

        if (searchTerm) {
          filtered = filtered.filter(function(a) {
            return a.patientName.toLowerCase().indexOf(searchTerm) !== -1;
          });
        }

        renderPsychologistAppointments(filtered);
      }

      function renderPsychologistAppointments(list) {
        const sorted = list.slice().sort(function(a, b) {
          const dateA = new Date(a.appointmentDate + ' ' + a.appointmentTime);
          const dateB = new Date(b.appointmentDate + ' ' + b.appointmentTime);
          return dateB - dateA;
        });

        const appointmentsContainer = document.getElementById('psychologistAppointments');
        if (!appointmentsContainer) return;

        if (sorted.length === 0) {
          appointmentsContainer.innerHTML = 
            '<div class="empty-state">' +
              '<div class="icon">üìã</div>' +
              '<p>Nenhum atendimento encontrado.</p>' +
            '</div>';
          return;
        }

        const appointments = allRecords.filter(function(r) {
          return r.type === 'appointment';
        });

        appointmentsContainer.innerHTML = sorted.map(function(apt) {
          const sessionCount = appointments.filter(function(a) {
            return a.patientName === apt.patientName && a.status === 'completed';
          }).length;

          const absenceCount = appointments.filter(function(a) {
            return a.patientName === apt.patientName && a.status === 'cancelled' && a.absenceReason;
          }).length;

          let html = '<div class="appointment-card ' + apt.status + '">' +
            '<div class="appointment-header">' +
              '<div class="patient-info">' +
                '<h3>' + escapeHtml(apt.patientName) + '</h3>' +
                '<div class="appointment-datetime">üìÖ ' + formatDate(apt.appointmentDate) + ' √†s ' + apt.appointmentTime + '</div>' +
              '</div>' +
              '<span class="status-badge status-' + apt.status + '">' + getStatusText(apt.status) + '</span>' +
            '</div>' +
            '<div style="display: flex; gap: 10px; margin-bottom: 10px;">' +
              '<div class="session-count-badge">üìä ' + sessionCount + ' atendimento(s) realizado(s)</div>';
          
          if (absenceCount > 0) {
            html += '<div class="session-count-badge" style="background: #f56565;">‚ùå ' + absenceCount + ' falta(s)</div>';
          }
          
          html += '</div>' +
            '<div class="appointment-details">' +
              '<div class="detail-item"><strong>Idade:</strong> ' + escapeHtml(apt.patientAge) + '</div>' +
              '<div class="detail-item"><strong>Escola:</strong> ' + escapeHtml(apt.school) + '</div>' +
              '<div class="detail-item"><strong>Respons√°vel:</strong> ' + escapeHtml(apt.guardianName) + '</div>' +
              '<div class="detail-item"><strong>Telefone:</strong> ' + escapeHtml(apt.guardianPhone) + '</div>' +
            '</div>';

          if (apt.sessionNotes) {
            html += '<div style="margin-top: 15px; padding: 15px; background: white; border-radius: 8px;">' +
              '<strong>Observa√ß√µes:</strong><br>' +
              '<p style="margin: 10px 0 0 0; white-space: pre-wrap;">' + escapeHtml(apt.sessionNotes) + '</p>' +
            '</div>';
          }

          if (apt.absenceReason) {
            html += '<div style="margin-top: 15px; padding: 15px; background: #fff5f5; border-radius: 8px; border-left: 4px solid #f56565;">' +
              '<strong style="color: #742a2a;">Motivo da Falta:</strong><br>' +
              '<p style="margin: 10px 0 0 0; white-space: pre-wrap; color: #4a5568;">' + escapeHtml(apt.absenceReason) + '</p>' +
            '</div>';
          }

          html += '<div class="appointment-actions">';
          
          if (apt.status === 'scheduled') {
            html += '<button class="btn btn-success" onclick="window.appFunctions.openSessionModal(\'' + apt.__backendId + '\')">' +
              '‚úì Realizar Atendimento' +
            '</button>' +
            '<button class="btn btn-danger" onclick="window.appFunctions.openAbsenceModal(\'' + apt.__backendId + '\')">' +
              '‚ùå Registrar Falta' +
            '</button>';
          }
          
          html += '</div></div>';
          
          return html;
        }).join('');
      }

      function openEditModal(backendId) {
        currentEditAppointment = allRecords.find(function(a) {
          return a.__backendId === backendId;
        });
        
        if (!currentEditAppointment) return;
        
        const editPatientName = document.getElementById('editPatientName');
        const editPatientAge = document.getElementById('editPatientAge');
        const editSchool = document.getElementById('editSchool');
        const editGuardianName = document.getElementById('editGuardianName');
        const editGuardianPhone = document.getElementById('editGuardianPhone');
        const editAppointmentDate = document.getElementById('editAppointmentDate');
        const editAppointmentTime = document.getElementById('editAppointmentTime');
        
        if (editPatientName) editPatientName.value = currentEditAppointment.patientName;
        if (editPatientAge) editPatientAge.value = currentEditAppointment.patientAge;
        if (editSchool) editSchool.value = currentEditAppointment.school;
        if (editGuardianName) editGuardianName.value = currentEditAppointment.guardianName;
        if (editGuardianPhone) editGuardianPhone.value = currentEditAppointment.guardianPhone;
        if (editAppointmentDate) editAppointmentDate.value = currentEditAppointment.appointmentDate;
        if (editAppointmentTime) editAppointmentTime.value = currentEditAppointment.appointmentTime;
        
        const modal = document.getElementById('editModal');
        if (modal) {
          modal.classList.add('active');
        }
      }

      async function updateAppointment(e) {
        e.preventDefault();

        if (!currentEditAppointment) return;

        const btn = document.getElementById('updateAppointmentBtn');
        if (btn) {
          btn.disabled = true;
          btn.innerHTML = '<span class="loading-spinner"></span> Salvando...';
        }

        const editPatientName = document.getElementById('editPatientName');
        const editPatientAge = document.getElementById('editPatientAge');
        const editSchool = document.getElementById('editSchool');
        const editGuardianName = document.getElementById('editGuardianName');
        const editGuardianPhone = document.getElementById('editGuardianPhone');
        const editAppointmentDate = document.getElementById('editAppointmentDate');
        const editAppointmentTime = document.getElementById('editAppointmentTime');

        if (editPatientName) currentEditAppointment.patientName = editPatientName.value.trim();
        if (editPatientAge) currentEditAppointment.patientAge = editPatientAge.value.trim();
        if (editSchool) currentEditAppointment.school = editSchool.value.trim();
        if (editGuardianName) currentEditAppointment.guardianName = editGuardianName.value.trim();
        if (editGuardianPhone) currentEditAppointment.guardianPhone = editGuardianPhone.value.trim();
        if (editAppointmentDate) currentEditAppointment.appointmentDate = editAppointmentDate.value;
        if (editAppointmentTime) currentEditAppointment.appointmentTime = editAppointmentTime.value;

        if (window.dataSdk) {
          const result = await window.dataSdk.update(currentEditAppointment);
          
          if (result.isOk) {
            closeModal('editModal');
            showToast('Agendamento atualizado com sucesso!');
          } else {
            showToast('Erro ao atualizar agendamento. Tente novamente.', 'error');
          }
        }

        if (btn) {
          btn.disabled = false;
          btn.innerHTML = 'Salvar Altera√ß√µes';
        }
      }

      function openSessionModal(backendId) {
        currentSessionAppointment = allRecords.find(function(a) {
          return a.__backendId === backendId;
        });
        
        if (!currentSessionAppointment) return;
        
        const appointments = allRecords.filter(function(r) {
          return r.type === 'appointment';
        });
        
        const sessionCount = appointments.filter(function(a) {
          return a.patientName === currentSessionAppointment.patientName && a.status === 'completed';
        }).length;

        const sessionPatientInfo = document.getElementById('sessionPatientInfo');
        if (sessionPatientInfo) {
          sessionPatientInfo.innerHTML = 
            '<strong style="font-size: 16px; color: #2d3748;">' + escapeHtml(currentSessionAppointment.patientName) + '</strong><br>' +
            '<span style="color: #4a5568;">Idade: ' + escapeHtml(currentSessionAppointment.patientAge) + ' | Escola: ' + escapeHtml(currentSessionAppointment.school) + '</span><br>' +
            '<span style="color: #4a5568;">Atendimentos anteriores: ' + sessionCount + '</span>';
        }

        const sessionNotes = document.getElementById('sessionNotes');
        if (sessionNotes) {
          sessionNotes.value = '';
        }
        
        const modal = document.getElementById('sessionModal');
        if (modal) {
          modal.classList.add('active');
        }
      }

      async function completeSession(e) {
        e.preventDefault();

        if (!currentSessionAppointment) return;

        const btn = document.getElementById('completeSessionBtn');
        if (btn) {
          btn.disabled = true;
          btn.innerHTML = '<span class="loading-spinner"></span> Salvando...';
        }

        const sessionNotes = document.getElementById('sessionNotes');
        if (!sessionNotes) {
          if (btn) {
            btn.disabled = false;
            btn.innerHTML = 'Concluir Atendimento';
          }
          return;
        }
        
        const notes = sessionNotes.value.trim();
        
        currentSessionAppointment.status = 'completed';
        currentSessionAppointment.sessionNotes = notes;

        if (window.dataSdk) {
          const result = await window.dataSdk.update(currentSessionAppointment);
          
          if (result.isOk) {
            closeModal('sessionModal');
            showToast('Atendimento conclu√≠do com sucesso!');
          } else {
            showToast('Erro ao concluir atendimento. Tente novamente.', 'error');
          }
        }

        if (btn) {
          btn.disabled = false;
          btn.innerHTML = 'Concluir Atendimento';
        }
      }

      function openAbsenceModal(backendId) {
        currentAbsenceAppointment = allRecords.find(function(a) {
          return a.__backendId === backendId;
        });
        
        if (!currentAbsenceAppointment) return;
        
        const appointments = allRecords.filter(function(r) {
          return r.type === 'appointment';
        });
        
        const sessionCount = appointments.filter(function(a) {
          return a.patientName === currentAbsenceAppointment.patientName && a.status === 'completed';
        }).length;

        const absenceCount = appointments.filter(function(a) {
          return a.patientName === currentAbsenceAppointment.patientName && a.status === 'cancelled' && a.absenceReason;
        }).length;

        const absencePatientInfo = document.getElementById('absencePatientInfo');
        if (absencePatientInfo) {
          absencePatientInfo.innerHTML = 
            '<strong style="font-size: 16px; color: #742a2a;">‚ö†Ô∏è ' + escapeHtml(currentAbsenceAppointment.patientName) + '</strong><br>' +
            '<span style="color: #4a5568;">Idade: ' + escapeHtml(currentAbsenceAppointment.patientAge) + ' | Escola: ' + escapeHtml(currentAbsenceAppointment.school) + '</span><br>' +
            '<span style="color: #4a5568;">Atendimentos realizados: ' + sessionCount + ' | Faltas anteriores: ' + absenceCount + '</span>';
        }

        const absenceReason = document.getElementById('absenceReason');
        if (absenceReason) {
          absenceReason.value = '';
        }
        
        const modal = document.getElementById('absenceModal');
        if (modal) {
          modal.classList.add('active');
        }
      }

      async function registerAbsence(e) {
        e.preventDefault();

        if (!currentAbsenceAppointment) return;

        const btn = document.getElementById('registerAbsenceBtn');
        if (btn) {
          btn.disabled = true;
          btn.innerHTML = '<span class="loading-spinner"></span> Salvando...';
        }

        const absenceReason = document.getElementById('absenceReason');
        if (!absenceReason) {
          if (btn) {
            btn.disabled = false;
            btn.innerHTML = 'Registrar Falta';
          }
          return;
        }
        
        const reason = absenceReason.value.trim();
        
        currentAbsenceAppointment.status = 'cancelled';
        currentAbsenceAppointment.absenceReason = reason;

        if (window.dataSdk) {
          const result = await window.dataSdk.update(currentAbsenceAppointment);
          
          if (result.isOk) {
            closeModal('absenceModal');
            showToast('Falta registrada com sucesso', 'error');
          } else {
            showToast('Erro ao registrar falta. Tente novamente.', 'error');
          }
        }

        if (btn) {
          btn.disabled = false;
          btn.innerHTML = 'Registrar Falta';
        }
      }

      function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.classList.remove('active');
        }
        
        if (modalId === 'sessionModal') {
          currentSessionAppointment = null;
        } else if (modalId === 'editModal') {
          currentEditAppointment = null;
        } else if (modalId === 'absenceModal') {
          currentAbsenceAppointment = null;
        }
      }

      function showToast(message, type) {
        type = type || 'success';
        const toast = document.createElement('div');
        toast.className = 'toast ' + type;
        toast.textContent = message;
        document.body.appendChild(toast);

        setTimeout(function() {
          if (document.body.contains(toast)) {
            document.body.removeChild(toast);
          }
        }, 3000);
      }

      function updatePatientSelect() {
        const select = document.getElementById('patientSelect');
        if (!select) return;
        
        const appointments = allRecords.filter(function(r) {
          return r.type === 'appointment';
        });
        
        const uniquePatients = [];
        const seen = new Set();
        
        appointments.forEach(function(apt) {
          if (!seen.has(apt.patientName)) {
            seen.add(apt.patientName);
            uniquePatients.push(apt);
          }
        });
        
        const sortedPatients = uniquePatients.sort(function(a, b) {
          return a.patientName.localeCompare(b.patientName);
        });
        
        select.innerHTML = '<option value="">-- Novo Aluno --</option>';
        sortedPatients.forEach(function(patient) {
          const option = document.createElement('option');
          option.value = patient.id;
          option.textContent = patient.patientName;
          option.dataset.age = patient.patientAge;
          option.dataset.school = patient.school;
          option.dataset.guardian = patient.guardianName;
          option.dataset.phone = patient.guardianPhone;
          select.appendChild(option);
        });
      }

      function fillPatientData() {
        const select = document.getElementById('patientSelect');
        if (!select) return;
        
        const selectedOption = select.options[select.selectedIndex];
        
        const patientName = document.getElementById('patientName');
        const patientAge = document.getElementById('patientAge');
        const school = document.getElementById('school');
        const guardianName = document.getElementById('guardianName');
        const guardianPhone = document.getElementById('guardianPhone');
        
        if (!select.value) {
          if (patientName) patientName.value = '';
          if (patientAge) patientAge.value = '';
          if (school) school.value = '';
          if (guardianName) guardianName.value = '';
          if (guardianPhone) guardianPhone.value = '';
          return;
        }

        if (patientName) patientName.value = selectedOption.textContent;
        if (patientAge) patientAge.value = selectedOption.dataset.age || '';
        if (school) school.value = selectedOption.dataset.school || '';
        if (guardianName) guardianName.value = selectedOption.dataset.guardian || '';
        if (guardianPhone) guardianPhone.value = selectedOption.dataset.phone || '';
      }

      function formatDate(dateStr) {
        const date = new Date(dateStr + 'T00:00:00');
        return date.toLocaleDateString('pt-BR');
      }

      function getStatusText(status) {
        const texts = {
          scheduled: 'Agendado',
          completed: 'Conclu√≠do',
          cancelled: 'Cancelado'
        };
        return texts[status] || status;
      }

      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      window.appFunctions = {
        openEditModal: openEditModal,
        openSessionModal: openSessionModal,
        openAbsenceModal: openAbsenceModal
      };

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a76285af43af623',t:'MTc2NDYyOTU3NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
